<!DOCTYPE HTML><html>
<!-- Rui Santos - Complete project details at https://RandomNerdTutorials.com

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files.
The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software. -->
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <link rel="icon" type="image/x-icon" href="./favico">
  <script type="text/javascript" src="./highcharts.js"></script>
  <style>
    body {
      color: white;
      margin: 0;
      background-color: #333333;
    }
    .espestacao {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 1.3rem;
      letter-spacing: 1px;
    }
    #logo {
      height: 50px;
    }
    #cabecalho{
      height: 50px;
      margin-bottom: 80px;
      padding: 10px;
      background-color: #4b4b4b;
    }
    #logo_div{
      display: flex;
      height: 100%;
      width: 15%;
      float: left;
    }
    #text_div{
      height: 100%;
      width: 70%;
      display: flex;
      float: left;
      align-items: center;
      justify-content: center;
    }
    #chart-temperature{
      margin-bottom: 50px;
    }
    #chart-humidity{
      margin-bottom: 50px;
    }
    #chart-chuva{

    }
  </style>
</head>
<body>
  <div id="cabecalho">
    <div id="logo_div">
      <img id="logo" src="./logo">
    </div>
    <div id="text_div">
      <p class="espestacao">Estação Metereológica</p>
    </div>
    esp32
  </div>

  <div id="container"></div>
  <div id="chart-temperature" class="container"></div>
  <div id="chart-humidity" class="container"></div>
  <div id="chart-chuva" class="container"></div>
  <!-- <div id="chart-pressure" class="container"></div> -->
</body>

<script>
Highcharts.setOptions({
    colors: ['#058DC7', '#50B432', '#ED561B', '#DDDF00', '#24CBE5', '#64E572', '#FF9655', '#FFF263', '#6AF9C4'],
    chart: {
        backgroundColor: '#333333',
        borderWidth: 0,
        plotBackgroundColor: '#333333',
        plotBorderWidth: 0
    },
    title: {
        style: {
            color: '#e6e6e6',
            font: '16px "Trebuchet MS", Verdana, sans-serif'
        }
    },
    subtitle: {
        style: {
            color: '#e6e6e6',
            font: '12px "Trebuchet MS", Verdana, sans-serif'
        }
    },
    xAxis: {
        gridLineWidth: 1,
        gridLineColor: '#666666',
        lineColor: '#595959',
        tickColor: '#595959',
        labels: {
            style: {
                color: '#e6e6e6',
                font: '11px Trebuchet MS, Verdana, sans-serif'
            }
        },
        title: {
            style: {
                color: '#e6e6e6',
                fontWeight: 'bold',
                fontSize: '12px',
                fontFamily: 'Trebuchet MS, Verdana, sans-serif'

            }
        }
    },
    yAxis: {
        alternateGridColor: null,
        gridLineColor: '#666666',
        minorTickInterval: 'none',
        lineColor: '#595959',
        lineWidth: 1,
        tickWidth: 1,
        labels: {
            style: {
                color: '#e6e6e6',
                font: '11px Trebuchet MS, Verdana, sans-serif'
            }
        },
        title: {
            style: {
                color: '#e6e6e6',
                fontWeight: 'bold',
                fontSize: '12px',
                fontFamily: 'Trebuchet MS, Verdana, sans-serif'
            }
        }
    },
    legend: {
        itemStyle: {
            font: '9pt Trebuchet MS, Verdana, sans-serif',
            color: 'white'

        },
        itemHoverStyle: {
            color: '#e6e6e6'
        },
        itemHiddenStyle: {
            color: 'gray'
        }
    },
    credits: {
        style: {
            right: '10px'
        }
    },
    labels: {
        style: {
            color: '#e6e6e6'
        }
    }
});


/*
// create the chart
Highcharts.chart('container', {

xAxis: {
    type: 'datetime'
},

series: [{
    data: [29.9, 71.5, 106.4, 129.2, 144.0, 176.0, 135.6, 148.5, 216.4, 194.1, 95.6, 54.4],
    pointStart: Date.UTC(2010, 0, 1),
    pointInterval: 3600 * 1000 // one hour
}]
});
*/


var chartT = new Highcharts.Chart({
  chart:{ renderTo : 'chart-temperature' },
  title: { text: 'Temperatura' },
  series: [{
    showInLegend: false,
    data: []
  }],
  plotOptions: {
    line: { animation: false,
      dataLabels: { enabled: true, color: '#e6e6e6' },
    },
    series: { color: '#059e8a' }
  },
  xAxis: { type: 'datetime',
    dateTimeLabelFormats: { second: '%H:%M:%S' }
  },
  yAxis: {
    title: { text: 'Temperatura (Celsius)' }
    //title: { text: 'Temperature (Fahrenheit)' }
  },
  credits: { enabled: false }
});

setInterval(function ( ) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var x = (new Date()).getTime(),
          y = parseFloat(this.responseText);
      //console.log(this.responseText);
      if(chartT.series[0].data.length > 40) {
        chartT.series[0].addPoint([x, y], true, true, true);
      } else {
        chartT.series[0].addPoint([x, y], true, false, true);
      }
    }
  };
  xhttp.open("GET", "/temperature", true);
  xhttp.send();
}, 5000 ) ;

var chartH = new Highcharts.Chart({
  chart:{ renderTo:'chart-humidity' }, 
  title: { text: 'Umidade' },
  series: [{
    showInLegend: false,
    data: []
  }],
  plotOptions: {
    line: { animation: false,
      dataLabels: { enabled: true, color: '#e6e6e6' },
    },
  },
  xAxis: {
    type: 'datetime',
    dateTimeLabelFormats: { second: '%H:%M:%S' }
  },
  yAxis: {
    title: { text: 'Umidade (%)' }
  },
  credits: { enabled: false }
});
setInterval(function ( ) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var x = (new Date()).getTime(),
          y = parseFloat(this.responseText);
      //console.log(this.responseText);
      if(chartH.series[0].data.length > 40) {
        chartH.series[0].addPoint([x, y], true, true, true);
      } else {
        chartH.series[0].addPoint([x, y], true, false, true);
      }
    }
  };
  xhttp.open("GET", "/humidity", true);
  xhttp.send();
}, 5000 ) ;


var chartP = new Highcharts.Chart({
  chart:{ renderTo:'chart-chuva' },
  title: { text: 'Chuva' },
  series: [{
    showInLegend: false,
    data: []
  }],
  plotOptions: {
    line: { animation: false,
      dataLabels: { enabled: true, color: '#e6e6e6' },
    },
    series: { color: '#b35be3' }
  },
  xAxis: {
    type: 'datetime',
    dateTimeLabelFormats: { second: '%H:%M:%S' }
  },
  yAxis: {
    title: { text: 'Chuva (0 ou 1)' }
  },
  credits: { enabled: false }
});
setInterval(function ( ) {
  var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      var x = (new Date()).getTime(),
          y = parseFloat(this.responseText);
      //console.log(this.responseText);
      if(chartP.series[0].data.length > 40) {
        chartP.series[0].addPoint([x, y], true, true, true);
      } else {
        chartP.series[0].addPoint([x, y], true, false, true);
      }
    }
  };
  xhttp.open("GET", "/chuva", true);
  xhttp.send();
}, 5000 ) ;

</script>
</html>
